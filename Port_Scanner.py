import pyfiglet
import sys
import socket

def Analyse_port(ip,port):
    result = 1
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(0.5)
        state_port = sock.connect_ex((ip,port))
        if state_port == 0:
            result = state_port
        sock.close()
    except:
        pass

    return result

def Open_ports(ip,ports):
    for port in ports:
        sys.stdout.flush()
        verifPort = Analyse_port(ip,port)
        if verifPort == 0:
            print("Le port "+str(port)+ " est ouvert")




banner = pyfiglet.figlet_format("Port_Scanner")
print(banner)

ip = sys.argv[1]

try:
    
    print("Faites votre choix : ")
    print("0. Scanner les premiers ports de la machine")
    print("1. Scanner tous les ports de la machine")

    choice = int(input('Saissisez votre réponse'))
    match choice:
        case 0:
            ports = range(1,1024)
            print("Analyse des ports de la machine " + str(ip))
            Open_ports(ip,ports)

        case 1:
            ports = range(1,65535)
            print("Analyse des ports de la machine " + str(ip))
            Open_ports(ip,ports)
except:
    print("Il nécessaire de définir l'adresse ip de la machine cible!")